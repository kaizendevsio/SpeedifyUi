@*
NumberInput Component - Numeric input with validation
Number input with min/max/step and optional unit label
*@

<div class="number-input @(Disabled ? "number-input-disabled" : "")">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="number-input-label" for="@Id">@Label</label>
    }
    
    <div class="number-input-wrapper">
        <input type="number"
               id="@Id"
               class="number-input-control @(HasError ? "number-input-error" : "")"
               value="@Value"
               min="@Min"
               max="@Max"
               step="@Step"
               placeholder="@Placeholder"
               disabled="@Disabled"
               @onchange="HandleChange"
               @oninput="HandleInput" />
        
        @if (!string.IsNullOrEmpty(Unit))
        {
            <span class="number-input-unit">@Unit</span>
        }
    </div>
    
    @if (!string.IsNullOrEmpty(HelpText))
    {
        <div class="number-input-help">@HelpText</div>
    }
    
    @if (HasError)
    {
        <div class="number-input-validation-error">@ErrorMessage</div>
    }
</div>

@code {
    /// <summary>
    /// Unique identifier for the input element.
    /// </summary>
    [Parameter]
    public string Id { get; set; } = Guid.NewGuid().ToString();

    /// <summary>
    /// Current numeric value.
    /// </summary>
    [Parameter]
    public double Value { get; set; }

    /// <summary>
    /// Callback when value changes.
    /// </summary>
    [Parameter]
    public EventCallback<double> OnChange { get; set; }

    /// <summary>
    /// Callback when value changes (fires on input event).
    /// </summary>
    [Parameter]
    public EventCallback<double> OnInput { get; set; }

    /// <summary>
    /// Minimum allowed value.
    /// </summary>
    [Parameter]
    public double? Min { get; set; }

    /// <summary>
    /// Maximum allowed value.
    /// </summary>
    [Parameter]
    public double? Max { get; set; }

    /// <summary>
    /// Step increment for the input.
    /// </summary>
    [Parameter]
    public double Step { get; set; } = 1;

    /// <summary>
    /// Unit label displayed after the input (e.g., "ms", "Mbps").
    /// </summary>
    [Parameter]
    public string? Unit { get; set; }

    /// <summary>
    /// Label text displayed above the input.
    /// </summary>
    [Parameter]
    public string? Label { get; set; }

    /// <summary>
    /// Placeholder text when input is empty.
    /// </summary>
    [Parameter]
    public string? Placeholder { get; set; }

    /// <summary>
    /// Help text displayed below the input.
    /// </summary>
    [Parameter]
    public string? HelpText { get; set; }

    /// <summary>
    /// Whether the input is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    private bool HasError { get; set; }
    private string ErrorMessage { get; set; } = "";

    private async Task HandleChange(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), out var newValue))
        {
            if (ValidateValue(newValue))
            {
                Value = newValue;
                await OnChange.InvokeAsync(newValue);
            }
        }
    }

    private async Task HandleInput(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), out var newValue))
        {
            if (ValidateValue(newValue))
            {
                Value = newValue;
                await OnInput.InvokeAsync(newValue);
            }
        }
    }

    private bool ValidateValue(double value)
    {
        HasError = false;
        ErrorMessage = "";

        if (Min.HasValue && value < Min.Value)
        {
            HasError = true;
            ErrorMessage = $"Value must be at least {Min.Value}";
            return false;
        }

        if (Max.HasValue && value > Max.Value)
        {
            HasError = true;
            ErrorMessage = $"Value must be at most {Max.Value}";
            return false;
        }

        return true;
    }
}